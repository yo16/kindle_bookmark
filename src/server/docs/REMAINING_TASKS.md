# 残タスクと今後の課題

T104エラーハンドリング基盤実装完了後の残タスクをまとめます。

## 🔧 技術的改善項目

### 1. ESLint警告の対処（優先度：低）

現在31件の警告が残っています：

**anyの使用箇所**
- `src/types/errors.ts` - エラー詳細情報の型
- `src/utils/errors.ts` - 汎用的なエラー処理
- `src/middleware/errorHandler.ts` - Express型との互換性

**console.log使用箇所**
- `src/services/kindleParser.ts` - デバッグ用ログ出力
- `src/services/collectionParser.ts` - デバッグ用ログ出力
- テストファイル内 - テスト実行時の情報出力

**process.exit使用箇所**
- `src/middleware/errorHandler.ts` - グレースフルシャットダウン
- `src/server.ts` - サーバー起動エラー時の終了

**対処方針**: これらは現時点では機能的に問題なく、T203/T204実装後に整理する

### 2. 既存テストの問題（優先度：中）

**sqlite3バイナリエラー**
```
/mnt/d/public/github/yo16/kindle_bookmark/src/server/node_modules/sqlite3/build/Release/node_sqlite3.node: invalid ELF header
```

**対処方針**:
- Windows/WSL環境の違いによるバイナリ問題
- T202（SQLiteパーサー）の再テスト時に解決する

**影響**: T104エラーハンドリングには影響なし

## 📋 次期実装チケット

### T203: パス自動検出機能（完了）
- **ステータス**: DONE (2025-09-17) ✅
- **実装ファイル**: `src/services/pathDetector.ts`
- **テスト**: `src/services/__tests__/pathDetector.test.ts`
- **エラーハンドリング**: KindlePathNotFoundError等を活用

### T204: 書籍データモデル定義（高優先度）
- **依存関係**: T201, T202完了済み ✅
- **要件**: 統一された書籍データ構造の定義
- **エラーハンドリング**: T104で実装済みのValidationErrorを活用

## 🔒 セキュリティ改善項目

### ログ出力の最適化
- **現状**: console.logとWinstonの混在使用
- **改善**: すべてWinstonログシステムに統一
- **タイミング**: T203/T204実装と並行

### エラー情報の制御
- **現状**: 開発環境でスタックトレース出力
- **改善**: 本番環境での情報漏洩防止の強化
- **タイミング**: 本番デプロイ前（Phase1完了時）

## 🧪 テスト改善項目

### T104関連テストの拡充
- **現状**: 24件のテストが全て成功 ✅
- **改善項目**:
  - 異常系テストケースの追加
  - パフォーマンステストの追加
  - 統合テストの強化

### 既存テストの修正
- **完了**: TypeScriptコンパイルエラー修正済み ✅
- **残項目**: sqlite3関連テストの環境問題解決

## 📚 ドキュメント更新項目

### APIドキュメント
- **T104成果物**: エラーレスポンス仕様の文書化完了 ✅
- **次期更新**: T203/T204実装時のAPI仕様更新

### 開発ガイドライン
- **T104追加事項**: エラーハンドリングパターンの標準化完了 ✅
- **次期更新**: ファイル構成ガイドラインの更新

## ⏭️ 実装優先順位

### 即座に着手可能（依存関係解決済み）
1. **T204**: 書籍データモデル定義

### T203完了、T204完了後
3. **T301**: GET /api/books エンドポイント（Critical）
4. **T302**: POST /api/sync エンドポイント
5. **T303**: GET /api/collections エンドポイント

## 💡 技術的メモ

### T104実装での学習事項
- **成功パターン**: TypeScript型安全性とExpress統合
- **注意点**: 既存コードとの統合時の変数スコープ問題
- **ベストプラクティス**: 段階的テスト駆動開発

### 次期実装での活用事項
- T104で実装したエラークラス群の積極的な活用
- 統一レスポンス形式（createSuccessResponse/createErrorResponse）の利用
- Winstonロガーとの連携パターンの踏襲

## 📝 T203実装完了での更新事項

### 新たに解決された課題
- ✅ Kindleファイルパス検出の自動化
- ✅ 設定永続化機能の実装
- ✅ セキュリティ検証（パストラバーサル対策）
- ✅ TypeScript型安全性の確保

### T203実装で得られた技術資産
- **PathDetector サービス**: 他の機能でも活用可能なパス検出基盤
- **設定管理パターン**: JSON設定ファイルの永続化手法
- **テスト環境対応**: プラットフォーム固有コードのテスト戦略

### 残った制限事項・今後の改善案
1. **Jest環境のモック制約**: 実環境での動作は問題なし
2. **Windows専用設計**: macOS/Linux対応は将来検討事項
3. **パフォーマンス監視**: 大量ファイル検索時の最適化余地

---

**最終更新**: 2025-09-17  
**更新者**: Claude (T203実装完了時)